<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cl.mineduc.came.apoyo_mejora_continua.mappers.PerfilMenuMapper">
  <resultMap id="BaseResultMap" type="cl.mineduc.came.apoyo_mejora_continua.modelo.PerfilMenu">
    <id column="id_perfil_menu"  property="idPerfilMenu" />
    <result column="id_perfil" property="idPerfil" />
    <result column="id_sub_modulo" property="idSubModulo" />
    <result column="id_perfil_menu_acceso" property="idPerfilMenuAcceso" />
    <result column="start_date" property="startDate" />
    <result column="end_date" property="endDate" />
    <result column="status" property="status" />
  </resultMap>
  
  <sql id="query">
		select _pm.id_perfil_menu, 
			    _pm.id_perfil, 
			    _pm.id_sub_modulo, 
			    _pm.id_perfil_menu_acceso, 
			    _pm.start_date, 
    	 	  _pm.end_date, 
    	 	  _pm.status
    	from came.came_perfil_menu _pm
   </sql>	
  
  <delete id="deleteById" parameterType="java.lang.Long">
    delete from came.came_perfil_menu
    where id_perfil_menu = #{id_perfil_menu,jdbcType=BIGINT}
  </delete>
  
  <insert id="insert" parameterType="cl.mineduc.came.apoyo_mejora_continua.modelo.PerfilMenu">
     <selectKey keyColumn="id_perfil_menu" keyProperty="idPerfilMenu"
			order="BEFORE" resultType="java.lang.Long">
			(select came.next_id())
		</selectKey>
    insert into came.came_perfil_menu (
      id_perfil_menu, 
      id_perfil, 
      id_sub_modulo, 
      id_perfil_menu_acceso, 
      start_date, end_date, 
      status)
    values (
      #{idPerfilMenu,jdbcType=BIGINT}, 
      #{idPerfil,jdbcType=BIGINT}, 
      #{idSubModulo,jdbcType=BIGINT}, 
      #{idPerfilMenuAcceso,jdbcType=BIGINT}, 
      #{startDate,jdbcType=TIMESTAMP}, 
      #{endDate,jdbcType=TIMESTAMP}, 
      #{status,jdbcType=BIT})
  </insert>
  
  <update id="updateById" parameterType="cl.mineduc.came.apoyo_mejora_continua.modelo.PerfilMenu">
    update came.came_perfil_menu
    set 
        id_perfil = #{idPerfil,jdbcType=BIGINT},
        id_sub_modulo = #{idSubModulo,jdbcType=BIGINT},
        id_perfil_menu_acceso = #{idPerfilMenuAcceso,jdbcType=BIGINT},
        start_date = #{startDate,jdbcType=TIMESTAMP},
        end_date = #{endDate,jdbcType=TIMESTAMP},
        status = #{status,jdbcType=BIT}
    where id_perfil_menu = #{idPerfilMenu,jdbcType=BIGINT}
  </update>
  
  <select id="getById" parameterType="java.lang.Long" resultMap="BaseResultMap">
    <include refid="query"></include>	
    where _pm.id_perfil_menu = #{idPerfilMenu,jdbcType=BIGINT}
  </select>
  
  <select id="getByIdPerfil" parameterType="java.lang.Long" resultMap="BaseResultMap">
    <include refid="query"></include>	
    where _pm.id_perfil = #{idPerfil} and _pm.end_date is null
  </select>

  <select id="getAll" resultMap="BaseResultMap">
   <include refid="query"></include>
	order by _pm.id_perfil_menu asc
  </select>

  <select id="getByIdSubModulo" parameterType="java.lang.Long" resultMap="BaseResultMap">
    <include refid="query"></include>	
    where _pm.id_sub_modulo = #{idSubModulo,jdbcType=BIGINT}
  </select>
  
</mapper>